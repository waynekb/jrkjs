(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-77e377e8"],{"659d":function(t,i,n){},"6b5c":function(t,i,n){"use strict";n("659d")},e3ad:function(t,i,n){"use strict";n.r(i);var e=function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[n("el-tree",{attrs:{data:t.list,"expand-on-click-node":!1},scopedSlots:t._u([{key:"default",fn:function(i){var e=i.node,s=i.data;return n("span",{staticClass:"custom-tree-node"},[n("span",[t._v(t._s(s.description))]),t._v(" "),e.isLeaf?n("span",[s.permissions&&s.permissions.length>0?n("span",[n("i",{staticClass:"el-icon-check",staticStyle:{color:"#3c3"}}),t._v(" "),n("el-button",{attrs:{type:"text"},on:{click:function(i){return t.showPermissionDetail(e,s)}}},[t._v(t._s(s.permissions.length>1?s.permissions[0]+"等"+s.permissions.length+"个权限":""+s.permissions[0]))])],1):n("el-button",{attrs:{type:"text"},on:{click:function(i){return t.showPermissionDetail(e,s)}}},[t._v("无权限")])],1):n("span",[t._v(t._s(s.total>0?s.total+"个权限":""))])])}}])}),t._v(" "),n("el-button",{staticStyle:{"margin-top":"1rem",width:"100%"},attrs:{type:"success"},on:{click:function(i){return t.requireUpdate(!0)}}},[t._v("提交保存")]),t._v(" "),n("el-dialog",{attrs:{visible:t.show_permission_dialog,"append-to-body":""},on:{"update:visible":function(i){t.show_permission_dialog=i}}},[n("PermissionModify",{attrs:{name:t.currentPermission.name,title:t.currentPermission.title},on:{"require-close":function(i){t.show_permission_dialog=!1},"require-update":function(i){return t.requireUpdate(!0)}},model:{value:t.currentPermission.data,callback:function(i){t.$set(t.currentPermission,"data",i)},expression:"currentPermission.data"}})],1)],1)},s=[],o=(n("28a5"),n("456d"),n("ac6a"),n("7f7f"),n("0feb")),a={name:"PermissionManager",components:{PermissionModify:function(){return n.e("chunk-92bc8668").then(n.bind(null,"951b"))}},props:{userId:{type:String,default:null},auth:{type:Object,default:null}},data:function(){return{loading:!1,lastUpdate:"",list:[],itemDict:null,currentPermission:{name:null,title:null},show_permission_dialog:!1}},watch:{userId:{handler:function(t){this.load()},immediate:!0}},mounted:function(){this.init_load()},destroyed:function(){this.requireUpdate()},methods:{check_update:function(){return!1},requireUpdate:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.userId,e=this.check_update();i||e===this.lastUpdate?e!==this.lastUpdate&&this.do_submit(e,n):this.$confirm("权限有修改，是否更新","更新提醒",{type:"info"}).then((function(){t.do_submit(e,n)}))},do_submit:function(t,i){this.loading=!0},showPermissionDetail:function(t,i){this.currentPermission={data:i,title:t.parent.data.title,name:t.parent.data.name,total:0},this.show_permission_dialog=!0},load:function(){var t=this;if(this.itemDict){var i=this.userId;i&&(this.loading=!0,Object(o["b"])({id:i}).then((function(t){})).finally((function(){t.loading=!1,t.requireUpdate()})))}else setTimeout((function(){return t.load()}),200)},init_load:function(){var t=this;this.loading=!0,Object(o["a"])().then((function(i){t.load_config(i.model)})).finally((function(){t.loading=!1}))},load_config:function(t){var i=this;console.log("update permissions config",t),this.itemDict={},t.forEach((function(t){i.extract_node(t)})),this.load_config_list(this.itemDict.permission,this.list)},load_config_list:function(t,i){var n=this,e=Object.keys(t);e.forEach((function(e){if("item"!==e){var s=t[e].item||{};i.push(s),s.children=[],n.load_config_list(t[e],s.children)}}))},extract_node:function(t){var i=t.key,n=t.description,e=i.split("."),s=n.split("."),o=this.itemDict;return e.forEach((function(t){o[t]||(o[t]={}),o=o[t]})),o.item=t,{keys:e,descriptions:s}}}},r=a,c=(n("6b5c"),n("2877")),l=Object(c["a"])(r,e,s,!1,null,"f700615a",null);i["default"]=l.exports}}]);